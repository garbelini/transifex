{% extends "teams/team_menu.html" %}
{% load i18n %}
{% load cache %}
{% load pagination_tags %}
{% load txcommontags %}
{% load permissions %}
{% load txpermissions %}
{% load addons %}
{% load statistics_resources %}

{% block extracss %}
{{ block.super }}
<style>
  li.join_accepted {background-color:#A7DC71}
  li.join_rejected {background-color:#E04631}
  a.user.active {color:black}
</style>
{% endblock %}

{% block extrajs %}
  <script type="text/javascript">
    /*
     * Used to slide down or up a list of members.
     *
     * header: the jquery .previous() div of the list to be slided.
     */
    function list_toggle(list) {
      if (list.hasClass("collapsed")) {
        list.slideUp();
        list.removeClass("collapsed");
      } else {
        list.slideDown();
        list.addClass("collapsed");
      }
    }

    jQuery(document).ready(function() {
      /* handles the 'drawer' effect */
      $('a.user').pjax('#user_profile', {
        timeout: null,
        error: function(xhr, err) {}
      });

      /* handles pending list slider */
      jQuery("#pending_list :first").click(function() {
        list_toggle($(this).next());
      });

      /* handles invite list slider */
      jQuery("#invitation_list :first").click(function() {
        list_toggle($(this).next());
      });

      /* handles style of clicked users */
      $('a.user').live('click', function() {
        $('a.user').removeClass('active');
        $(this).addClass('active');
      });
    });
  </script>

{% endblock %}

{% block title %}{{ block.super }} | {{ project.name }}{% endblock %}

{% block project_header %}
{{block.super}}<span>&nbsp;/&nbsp;</span>
<span>{% blocktrans %}Members{% endblocktrans %}</span>
{% endblock%}

{% block content_main %}
{% get_permission "project_perm.submit_translations" for request.user and team as "can_submit_translations" %}
{% get_permission "project_perm.coordinate_team" for request.user and project,language as "is_coordinator" %}
{% get_permission "project_perm.maintain" for request.user and project as "is_maintainer" %}

<div class="obj_bigdetails">

  {% if perms.projects.change_team or is_coordinator %}
  <div class="clearfix">
    <a class="i16 settings nude-button right" href="{% url team_update project.slug language.code %}">{% trans "Manage members" %}</a>
  </div>
  {% endif %}

  {% if is_coordinator or is_maintainer %}
    <div id="team_members_sections">
      <a href="{% url team_members_edit project.slug language.code %}">{% trans "Edit members" %}</a>
      <a href="{% url team_members_create project.slug language.code %}">{% trans "Create team" %}</a>
    </div>
  {% endif %}

  <div id="drawerbox">

    <div id="lefty">
      {% if action == 'create' %}
        {% if is_coordinator or is_maintainer %}
          {% include 'teams/_invitation_list.html' %}
        {% endif %}
        {% autopaginate lang_speakers 10 %}
        {% include 'teams/_language_speakers.html' %}
      {% endif %}

      {% if action == 'edit' %}
        {% if is_coordinator or is_maintainer %}
          {% include 'teams/_pending_list.html' %}
        {% endif %}
        {% autopaginate all_members 10 %}
        {% include 'teams/_team_members.html' %}
      {% endif %}

      {% paginate %}
    </div>

    <div id="righty">
      <div id="user_profile">
        {% include "teams/_user_profile.html" %}
      </div>
    </div>

  </div>

</div>

{% endblock %}

{% block content_footer %}
  <div id="content_footer_center"></div>
{% endblock %}
